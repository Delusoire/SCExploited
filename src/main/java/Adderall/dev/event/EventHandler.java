package Adderall.dev.event;

import Adderall.dev.Main;
import Adderall.dev.gui.GuiCreativeChest;
import cpw.mods.fml.common.FMLCommonHandler;
import cpw.mods.fml.common.eventhandler.SubscribeEvent;
import net.geforcemods.securitycraft.api.IPasswordProtected;
import net.geforcemods.securitycraft.gui.GuiCheckPassword;
import net.minecraft.inventory.IInventory;
import net.minecraft.tileentity.TileEntity;
import net.minecraftforge.client.event.GuiOpenEvent;
import net.minecraftforge.common.MinecraftForge;
import net.minecraftforge.event.entity.player.PlayerInteractEvent;

import java.lang.reflect.Field;

public class EventHandler {
    public void init() {
        FMLCommonHandler.instance().bus().register(this);
        MinecraftForge.EVENT_BUS.register(this);
    }

    @SubscribeEvent
    public void onBlockClick(PlayerInteractEvent e) {
        if (e.action == PlayerInteractEvent.Action.RIGHT_CLICK_BLOCK && Main.mc.gameSettings.keyBindAttack.getIsKeyPressed() && Main.mc.thePlayer.isSneaking()) {
            TileEntity te = Main.mc.theWorld.getTileEntity(e.x, e.y, e.z);
            if (te instanceof IInventory) {
                Main.mc.displayGuiScreen(new GuiCreativeChest(te));
                e.setCanceled(true);
            }
        }
    }

    @SubscribeEvent
    public void onGuiOpen(GuiOpenEvent e) {
        if (Main.mc.thePlayer != null && Main.mc.thePlayer.isSneaking() && e.gui instanceof GuiCheckPassword) {
            try {
                GuiCheckPassword guiCheckPassword = (GuiCheckPassword) e.gui;
                Field tileEntityField = guiCheckPassword.getClass().getDeclaredField("tileEntity");
                tileEntityField.setAccessible(true);
                TileEntity tileEntity = (TileEntity) tileEntityField.get(guiCheckPassword);
                guiCheckPassword.checkCode(((IPasswordProtected) tileEntity).getPassword());
                guiCheckPassword.onGuiClosed();
            } catch (Exception ignored) { }
        }
    }
}
